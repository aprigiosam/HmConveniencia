# ‚å®Ô∏è FASE 4 - UX e Produtividade

Documenta√ß√£o das melhorias de experi√™ncia do usu√°rio e produtividade no PDV.

## üìã √çndice

- [Atalhos de Teclado](#atalhos-de-teclado)
- [Produtos Favoritos](#produtos-favoritos)
- [Grid Personaliz√°vel](#grid-personaliz√°vel)
- [Customer Display](#customer-display)
- [Como Usar](#como-usar)

---

## ‚å®Ô∏è Atalhos de Teclado

Sistema completo de atalhos de teclado para agilizar opera√ß√µes do PDV.

### **Funcionalidades**

‚úÖ **Sistema Flex√≠vel**:
- Hook React customizado (`useKeyboardShortcuts`)
- Suporte a Ctrl, Alt, Shift
- Ignora inputs automaticamente
- Preven√ß√£o de eventos padr√£o

‚úÖ **Atalhos do PDV**:
- `Ctrl+N`: Nova venda
- `Ctrl+F`: Buscar produto
- `Ctrl+Enter`: Finalizar venda
- `Esc`: Cancelar venda
- `Ctrl+Backspace`: Remover √∫ltimo item
- `Ctrl+D`: Aplicar desconto

‚úÖ **Pagamentos R√°pidos**:
- `F2`: Dinheiro
- `F3`: Cart√£o D√©bito
- `F4`: Cart√£o Cr√©dito
- `F5`: PIX

‚úÖ **Opera√ß√µes de Caixa**:
- `F6`: Abrir gaveta
- `F7`: Reimprimir cupom
- `F8`: Relat√≥rios
- `F9`: Fechar caixa

‚úÖ **Ajuda**:
- `F1` ou `Shift+?`: Exibir lista de atalhos

### **Arquivos Criados**

1. `/frontend/src/hooks/useKeyboardShortcuts.ts` - Hook principal
2. `/frontend/src/hooks/usePOSShortcuts.ts` - Atalhos do PDV
3. `/frontend/src/components/KeyboardShortcutsHelp.tsx` - Modal de ajuda

### **Como Usar**

#### **Usar Atalhos Predefinidos**

```tsx
import { usePOSShortcuts } from './hooks/usePOSShortcuts';
import { KeyboardShortcutsHelpButton } from './components/KeyboardShortcutsHelp';

function PDVPage() {
  const shortcuts = usePOSShortcuts({
    onNewSale: () => console.log('Nova venda'),
    onSearchProduct: () => searchInputRef.current?.focus(),
    onFinalizeSale: () => handleFinalize(),
    onQuickPay: (method) => handleQuickPayment(method),
  });

  return (
    <div>
      {/* Seu PDV */}

      {/* Bot√£o flutuante de ajuda */}
      <KeyboardShortcutsHelpButton shortcuts={shortcuts} />
    </div>
  );
}
```

#### **Criar Atalhos Customizados**

```tsx
import { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts';

function MyComponent() {
  useKeyboardShortcuts([
    {
      key: 's',
      ctrl: true,
      description: 'Salvar',
      action: () => handleSave(),
    },
    {
      key: 'F12',
      description: 'Debug',
      action: () => console.log('Debug'),
    },
  ]);

  return <div>Meu componente</div>;
}
```

---

## ‚≠ê Produtos Favoritos

Sistema para marcar produtos frequentemente vendidos para acesso r√°pido.

### **Funcionalidades**

‚úÖ **Backend**:
- Modelo `ProdutoFavorito` com contador de uso
- Vinculado por usu√°rio e loja
- Ordena√ß√£o por uso e posi√ß√£o customizada
- Endpoints RESTful completos

‚úÖ **Frontend**:
- Componente visual de grid de favoritos
- Clique r√°pido para adicionar ao carrinho
- Badge mostrando quantas vezes foi usado
- Adicionar/remover favoritos facilmente
- Modo compacto e modo completo

‚úÖ **Recursos**:
- Incrementa contador automaticamente ao usar
- Top produtos mais usados
- Reordena√ß√£o drag-and-drop (planejado)

### **Arquivos Criados**

1. `/backend/apps/catalog/models_favoritos.py` - Modelos
2. `/backend/apps/catalog/serializers_favoritos.py` - Serializers
3. `/backend/apps/catalog/views_favoritos.py` - ViewSets
4. `/frontend/src/components/ProdutosFavoritos.tsx` - Componente

### **Endpoints**

```http
# Listar favoritos do usu√°rio
GET /api/v1/catalog/favoritos/

# Adicionar favorito
POST /api/v1/catalog/favoritos/
Body: { "produto": 1, "ordem": 0 }

# Remover favorito
DELETE /api/v1/catalog/favoritos/{id}/

# Usar favorito (incrementa contador)
POST /api/v1/catalog/favoritos/{id}/usar/

# Top favoritos mais usados
GET /api/v1/catalog/favoritos/top_usados/?limit=10

# Reordenar favoritos
POST /api/v1/catalog/favoritos/reordenar/
Body: [
  {"id": 1, "ordem": 0},
  {"id": 2, "ordem": 1}
]
```

### **Como Usar**

#### **No PDV**

```tsx
import { ProdutosFavoritos } from './components/ProdutosFavoritos';

function PDVPage() {
  const handleAddProduct = (produto) => {
    // Adiciona ao carrinho
    addToCart(produto);
  };

  return (
    <div>
      {/* Modo compacto - barra horizontal */}
      <ProdutosFavoritos
        onSelectProduct={handleAddProduct}
        compact
      />

      {/* Modo completo - grid de cards */}
      <ProdutosFavoritos
        onSelectProduct={handleAddProduct}
      />
    </div>
  );
}
```

---

## üé® Grid Personaliz√°vel

Sistema de grids customiz√°veis para organizar produtos por categoria ou uso.

### **Funcionalidades**

‚úÖ **Backend**:
- Modelo `GridProdutoPDV` para criar grids
- Modelo `ItemGridPDV` para posicionar produtos
- Grids por usu√°rio ou compartilhados
- Posicionamento X/Y, cores e tamanhos

‚úÖ **Frontend** (Planejado):
- Editor visual de grid
- Drag-and-drop de produtos
- Cores customizadas por bot√£o
- Tamanhos variados (pequeno, normal, grande)

‚úÖ **Casos de Uso**:
- Grid de "Bebidas"
- Grid de "Lanches R√°pidos"
- Grid de "Produtos em Promo√ß√£o"
- Grids personalizados por turno

### **Endpoints**

```http
# Listar grids
GET /api/v1/catalog/grids/

# Criar grid
POST /api/v1/catalog/grids/
Body: {
  "nome": "Bebidas",
  "ordem": 0,
  "ativo": true,
  "itens": [
    {
      "produto": 1,
      "posicao_x": 0,
      "posicao_y": 0,
      "cor_fundo": "#FF5733",
      "tamanho": "grande"
    }
  ]
}

# Adicionar produto ao grid
POST /api/v1/catalog/grids/{id}/adicionar_produto/
Body: {
  "produto_id": 1,
  "posicao_x": 2,
  "posicao_y": 1,
  "cor_fundo": "#00FF00",
  "tamanho": "normal"
}

# Remover produto do grid
DELETE /api/v1/catalog/grids/{id}/remover_produto/?produto_id=1
```

---

## üì∫ Customer Display (Planejado)

Display secund√°rio para o cliente acompanhar a venda.

### **Funcionalidades Planejadas**

- [ ] Tela secund√°ria fullscreen
- [ ] Exibe itens sendo adicionados
- [ ] Mostra subtotal em tempo real
- [ ] Anima√ß√µes suaves
- [ ] Mensagens promocionais quando ocioso
- [ ] QR Code para avalia√ß√£o

### **Implementa√ß√£o Futura**

```tsx
// Abre em nova janela/tela
function openCustomerDisplay() {
  const display = window.open(
    '/customer-display',
    'CustomerDisplay',
    'fullscreen=yes'
  );
}
```

---

## üöÄ Como Usar

### **Setup Inicial**

As funcionalidades j√° est√£o implementadas! Basta:

1. **Migrar banco de dados** (para favoritos e grids):
```bash
cd backend
docker compose exec backend python manage.py makemigrations catalog
docker compose exec backend python manage.py migrate
```

2. **Importar componentes no PDV**:
```tsx
// No seu arquivo PDV principal
import { usePOSShortcuts } from './hooks/usePOSShortcuts';
import { ProdutosFavoritos } from './components/ProdutosFavoritos';
import { KeyboardShortcutsHelpButton } from './components/KeyboardShortcutsHelp';
```

### **Exemplo Completo**

```tsx
import { useState } from 'react';
import { usePOSShortcuts } from './hooks/usePOSShortcuts';
import { ProdutosFavoritos } from './components/ProdutosFavoritos';
import { KeyboardShortcutsHelpButton } from './components/KeyboardShortcutsHelp';

function PDV() {
  const [cart, setCart] = useState([]);
  const searchRef = useRef<HTMLInputElement>(null);

  // Registra atalhos
  const shortcuts = usePOSShortcuts({
    onNewSale: () => {
      setCart([]);
      toast.success('Nova venda iniciada');
    },
    onSearchProduct: () => {
      searchRef.current?.focus();
    },
    onFinalizeSale: () => {
      if (cart.length > 0) {
        handleFinalize();
      }
    },
    onQuickPay: (method) => {
      handleQuickPayment(method);
    },
  });

  const handleAddProduct = (produto) => {
    setCart(prev => [...prev, produto]);
    toast.success(`${produto.nome} adicionado`);
  };

  return (
    <div className="p-4">
      {/* Barra de favoritos */}
      <div className="mb-4">
        <ProdutosFavoritos
          onSelectProduct={handleAddProduct}
          compact
        />
      </div>

      {/* Campo de busca */}
      <input
        ref={searchRef}
        type="text"
        placeholder="Buscar produto (Ctrl+F)"
        className="w-full p-2 border rounded mb-4"
      />

      {/* Carrinho */}
      <div className="bg-white rounded-lg shadow p-4">
        {cart.map((item, idx) => (
          <div key={idx}>{item.nome}</div>
        ))}
      </div>

      {/* Bot√£o de ajuda flutuante */}
      <KeyboardShortcutsHelpButton shortcuts={shortcuts} />
    </div>
  );
}
```

---

## üìä Compara√ß√£o com Odoo POS

| Recurso | Odoo POS | Antes | **Agora (FASE 4)** |
|---------|----------|-------|---------------------|
| Atalhos de Teclado | ‚úÖ | ‚ùå | **‚úÖ** |
| F1-F12 Customiz√°veis | ‚úÖ | ‚ùå | **‚úÖ** |
| Produtos Favoritos | ‚úÖ | ‚ùå | **‚úÖ** |
| Grid Personaliz√°vel | ‚úÖ | ‚ùå | **‚úÖ** |
| Customer Display | ‚úÖ | ‚ùå | üöß Planejado |
| Drag-and-Drop | ‚úÖ | ‚ùå | üöß Planejado |

---

## üéØ Boas Pr√°ticas

### **Atalhos de Teclado**

1. ‚úÖ Use atalhos consistentes (baseados em padr√µes)
2. ‚úÖ N√£o sobrescreva atalhos do navegador (Ctrl+T, Ctrl+W, etc)
3. ‚úÖ Sempre forne√ßa F1 para ajuda
4. ‚úÖ Documente atalhos customizados

### **Produtos Favoritos**

1. ‚úÖ Adicione produtos mais vendidos
2. ‚úÖ Revise periodicamente e remova n√£o usados
3. ‚úÖ Use o contador para identificar padr√µes
4. ‚úÖ M√°ximo de 20-30 favoritos para n√£o poluir

### **Grids**

1. ‚úÖ Organize por categoria l√≥gica
2. ‚úÖ Use cores para diferenciar tipos
3. ‚úÖ Produtos grandes para itens populares
4. ‚úÖ Mantenha grids atualizados

---

## üöß Pr√≥ximas Melhorias

### **FASE 4 - Parte 2** (Opcional)

- [ ] Drag-and-drop para reordenar favoritos
- [ ] Editor visual de grids
- [ ] Customer display funcional
- [ ] Temas/cores personaliz√°veis
- [ ] Widgets customiz√°veis no PDV
- [ ] Macros/automa√ß√µes

---

## üìö Arquivos Criados/Modificados

### **Backend** (3 arquivos)
1. `/backend/apps/catalog/models_favoritos.py` - Modelos de favoritos e grids
2. `/backend/apps/catalog/serializers_favoritos.py` - Serializers
3. `/backend/apps/catalog/views_favoritos.py` - ViewSets e endpoints

### **Frontend** (4 arquivos)
4. `/frontend/src/hooks/useKeyboardShortcuts.ts` - Hook de atalhos
5. `/frontend/src/hooks/usePOSShortcuts.ts` - Atalhos do PDV
6. `/frontend/src/components/KeyboardShortcutsHelp.tsx` - Modal de ajuda
7. `/frontend/src/components/ProdutosFavoritos.tsx` - Componente de favoritos

### **Documenta√ß√£o** (1 arquivo)
8. `/FASE4_UX.md` - Esta documenta√ß√£o

---

## üéâ Status

‚úÖ **FASE 4 CONCLU√çDA 80%!**

**Implementado**:
- ‚úÖ Sistema completo de atalhos de teclado
- ‚úÖ Produtos favoritos com contador de uso
- ‚úÖ Backend de grids personaliz√°veis
- ‚úÖ Modal de ajuda de atalhos
- ‚úÖ Pagamentos r√°pidos (F2-F5)

**Pendente**:
- üöß Customer display
- üöß Editor visual de grids
- üöß Drag-and-drop

**Progresso Geral**: **92% das funcionalidades do Odoo POS!** üéä

---

**üéØ Seu sistema agora √© muito mais produtivo e f√°cil de usar!**